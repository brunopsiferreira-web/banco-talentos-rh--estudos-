{% extends "base.html" %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="mb-6">
        <a href="/jobs/{{ job.id }}" class="text-sm text-slate-500 hover:text-blue-600 mb-2 inline-flex items-center">
            <i class="ph ph-arrow-left mr-1"></i> Cancelar
        </a>
        <h1 class="text-2xl font-bold text-slate-800">Editar Vaga: {{ job.title }}</h1>
    </div>

    <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-8">
        <form id="editJobForm" action="/api/v1/jobs/{{ job.id }}" method="PUT">
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Título</label>
                    <input type="text" name="title" value="{{ job.title }}" required
                        class="w-full rounded-lg border-slate-300 focus:border-blue-500 focus:ring-blue-500 shadow-sm">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
                    <select name="status" class="w-full rounded-lg border-slate-300 focus:border-blue-500 bg-white">
                        <option value="aberta" {% if job.status=='aberta' %}selected{% endif %}>Aberta</option>
                        <option value="em análise" {% if job.status=='em análise' %}selected{% endif %}>Em Análise
                        </option>
                        <option value="fechada" {% if job.status=='fechada' %}selected{% endif %}>Fechada</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Descrição</label>
                    <textarea name="description" rows="5" required
                        class="w-full rounded-lg border-slate-300 focus:border-blue-500 shadow-sm">{{ job.description }}</textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Requisitos</label>
                    <input type="text" name="requirements" value="{{ job.requirements }}"
                        class="w-full rounded-lg border-slate-300 focus:border-blue-500 shadow-sm">
                </div>
            </div>

            <div class="mt-8 flex justify-end gap-3">
                <button type="submit"
                    class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
                    Salvar Alterações
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}

<script>
    document.getElementById('editJobForm').addEventListener('submit', async (e) => {
        e.preventDefault(); // Impede o navegador de recarregar a página (GET)

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/api/v1/jobs/{{ job.id }}', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                window.location.href = '/jobs'; // Redireciona após sucesso
            } else {
                alert("Erro ao atualizar a vaga");
            }
        } catch (error) {
            console.error("Erro:", error);
        }
    });
</script>

{% endblock %}